name: Reusable - Lint Actions ğŸ§ğŸ“œğŸ”
run-name: Lint Actions ğŸ§ğŸ“œğŸ”

on:
  workflow_call:
    inputs:
      ref:
        description: 'Ref to checkout.'
        required: true
        type: string
      workflow_files:
        description: 'Glob pattern for workflow files to lint.'
        required: false
        default: '.github/workflows/*.yaml,.gitea/workflows/*.yaml'
        type: string
    secrets:
      GITHUB_WORKFLOW_TOKEN:
        description: 'The GITHUB_TOKEN for authentication.'
        required: true

jobs:
  lint-actions:
    name: Lint Actions with ${{ matrix.linter }} ğŸ§ğŸ“œğŸ”
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
    permissions:
      # for actions/checkout to fetch code
      contents: read
      # required to upload results to advanced security.
      security-events: write
      # only required for a private repository by zizmorcore/zizmor-action to get the Action run status
      actions: read
    strategy:
      matrix:
        linter: [Actionlint, Zizmor]
    steps:
      # https://github.com/marketplace/actions/checkout
      - name: Check Out Repository Code ğŸ›’
        id: checkout
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
        with:
          ref: ${{ inputs.ref }}
          persist-credentials: false
          token: ${{ secrets.GITHUB_WORKFLOW_TOKEN }}

      # https://github.com/marketplace/actions/actionlint
      - name: Run Actionlint âœï¸
        id: actions-linter-actionlint
        if: ${{ matrix.linter == 'Actionlint' }}
        uses: raven-actions/actionlint@3a24062651993d40fed1019b58ac6fbdfbf276cc # v2.0.1
        with:
          matcher: true
          files: ${{ inputs.workflow_files }}
          group-result: true
          fail-on-error: true
          shellcheck: false
          pyflakes: false
          cache: true
          github-token: ${{ secrets.GITHUB_WORKFLOW_TOKEN }}

      # https://github.com/marketplace/actions/zizmor-action
      - name: Run Zizmor ğŸ›¡ï¸
        id: actions-linter-zizmor
        if: ${{ matrix.linter == 'Zizmor' }}
        uses: zizmorcore/zizmor-action@5ca5fc7a4779c5263a3ffa0e1f693009994446d1 # v0.1.2
        with:
          online-audits: true
          token: ${{ secrets.GITHUB_WORKFLOW_TOKEN }}
          advanced-security: true
